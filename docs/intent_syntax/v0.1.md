# Intent Language Specification — v0.1

> **Intent Language (IL)** is a declarative, compiler-first language for describing application behavior, data, and execution surfaces without writing imperative code.

This document defines **v0.1**, focused on correctness, determinism, and simplicity.

---

## 1. Design Goals

- Deterministic compilation
- No runtime interpretation
- No hidden behavior
- No free-form logic
- Human + LLM friendly
- Offline-first compiler
- Predictable generated code

---

## 2. Formal Grammar (EBNF)

This section defines the formal grammar for deterministic parsing.

```ebnf
(* File Structure *)
file            ::= declaration*
declaration     ::= decorator* (entity | action)
decorator       ::= "@" IDENTIFIER decorator_args?
decorator_args  ::= "(" arg ("," arg)* ")"
arg             ::= IDENTIFIER | STRING | NUMBER

(* Entity Definition *)
entity          ::= "entity" IDENTIFIER ":" NEWLINE INDENT field+ DEDENT
field           ::= IDENTIFIER ":" type field_decorator* NEWLINE
field_decorator ::= "@" ("primary" | "unique" | "optional" | "auto" | default_dec | validate_dec)
default_dec     ::= "default" "(" (STRING | NUMBER | BOOLEAN) ")"
validate_dec    ::= "validate" "(" validate_args ")"
validate_args   ::= validate_arg ("," validate_arg)*
validate_arg    ::= IDENTIFIER ":" (NUMBER | STRING)

(* Type System *)
type            ::= primitive_type | composite_type
primitive_type  ::= "string" | "number" | "boolean" | "uuid" | "datetime" | "email"
composite_type  ::= ref_type | list_type
ref_type        ::= "ref" "<" IDENTIFIER ">"
list_type       ::= "list" "<" type ">"

(* Action Definition *)
action          ::= "action" IDENTIFIER ":" NEWLINE INDENT action_body DEDENT
action_body     ::= input_section? process_section? output_section

(* Action Sections *)
input_section   ::= "input:" NEWLINE INDENT input_field+ DEDENT
input_field     ::= IDENTIFIER ":" type input_decorator? NEWLINE
input_decorator ::= "@map" "(" IDENTIFIER "," transform ")"
transform       ::= "none" | "hash"

process_section ::= "process:" NEWLINE INDENT derive_stmt+ DEDENT
derive_stmt     ::= "derive" IDENTIFIER "=" expression NEWLINE
expression      ::= STRING | NUMBER | dotted_path
dotted_path     ::= IDENTIFIER ("." IDENTIFIER)*

output_section  ::= "output:" IDENTIFIER "(" field_list ")" NEWLINE
field_list      ::= IDENTIFIER ("," IDENTIFIER)*

(* Terminals *)
IDENTIFIER      ::= [a-zA-Z_][a-zA-Z0-9_]*
STRING          ::= '"' [^"]* '"'
NUMBER          ::= [0-9]+
NEWLINE         ::= '\n'
INDENT          ::= consistent 4-space or 1-tab indentation
DEDENT          ::= return to previous indentation level
```

### 2.1 Indentation Rules

- Use **4 spaces** OR **1 tab** per level (not mixed)
- Indentation must be consistent within a file
- Blank lines are allowed between declarations but **not** between decorators and their targets

---

## 3. Core Declarations

Top-level declarations:

- `entity` — data model
- `action` — behavior intent

---

## 4. Decorators

### 4.1 Syntax

Decorators start with `@` and **must appear immediately before a declaration**.

```intent
@auth(User)
@api GET /users
action list_users:
```

---

### 4.2 Decorator Rules (Strict)

1. Decorators apply **only to the next declaration**
2. No blank line between decorator and declaration
3. Order does not matter (but consistency is recommended: `@auth` → `@api`)
4. Decorators inside blocks are forbidden
5. Unknown decorators cause compile-time errors

---

### 4.3 Common Errors (Invalid Syntax)

These examples show **invalid** Intent code:

```intent
# ❌ ERROR: Blank line between decorator and declaration
@api POST /users

action create_user:
    output: User(id)
```

```intent
# ❌ ERROR: Decorator inside block
action create_user:
    @validate  # Decorators cannot appear here
    input:
        email: string
```

```intent
# ❌ ERROR: Unknown decorator
@cache(60)  # Not a valid v0.1 decorator
action get_user:
    output: User(id)
```

---

## 5. Entities

### 5.1 Entity Syntax

```intent
entity User:
    id: string @primary
    email: string @unique
    hashed_password: string
```

---

### 5.2 Entity Rules

- Entities define **data shape only**
- No behavior inside entities
- Fields must have explicit types
- Field decorators are allowed

---

### 5.3 Built-in Field Types (v0.1)

#### Primitive Types

| Type | Description | Example |
|------|-------------|--------|
| `string` | Text value | `"hello"` |
| `number` | Numeric value (int or float) | `42`, `3.14` |
| `boolean` | True or false | `true`, `false` |
| `uuid` | Universally unique identifier | `"550e8400-e29b..."` |
| `datetime` | ISO 8601 timestamp | `"2026-01-20T12:00:00Z"` |
| `email` | Email address (validated format) | `"user@example.com"` |

#### Composite Types

| Type | Description | Example |
|------|-------------|--------|
| `ref<Entity>` | Reference to another entity | `ref<User>` |
| `list<T>` | List of values of type T | `list<string>`, `list<ref<Tag>>` |

#### Type Examples

```intent
entity Post:
    id: uuid @primary
    title: string
    author: ref<User>
    tags: list<string>
    created_at: datetime @auto
    view_count: number @default(0)
```

---

### 5.4 Entity Field Decorators

| Decorator | Meaning | Example |
|-----------|---------|--------|
| `@primary` | Primary key | `id: uuid @primary` |
| `@unique` | Unique constraint | `email: email @unique` |
| `@optional` | Nullable field | `bio: string @optional` |
| `@auto` | Auto-generated by system | `created_at: datetime @auto` |
| `@default(value)` | Default value if not provided | `role: string @default("user")` |
| `@validate(...)` | Validation constraints | `age: number @validate(min: 0, max: 150)` |

---

### 5.5 Validation Decorator

The `@validate` decorator enforces compile-time and runtime constraints.

```intent
@validate(constraint: value, ...)
```

#### Available Constraints

| Constraint | Applicable Types | Description |
|------------|-----------------|-------------|
| `min` | `number`, `string` | Minimum value or length |
| `max` | `number`, `string` | Maximum value or length |
| `pattern` | `string`, `email` | Regex pattern to match |
| `required` | all | Field must be present (default for non-optional) |

#### Validation Examples

```intent
entity User:
    id: uuid @primary
    username: string @validate(min: 3, max: 20)
    age: number @optional @validate(min: 0, max: 150)
    email: email @unique @validate(pattern: ".*@company\.com")
    role: string @default("user")
```

---

### 5.6 Default Decorator

The `@default` decorator provides a value when the field is not explicitly set.

```intent
@default(value)
```

#### Default Examples

```intent
entity Account:
    id: uuid @primary
    status: string @default("active")
    balance: number @default(0)
    is_verified: boolean @default(false)
    created_at: datetime @auto
```

Rules:
- Default value must match the field type
- `@default` cannot be used with `@auto`
- `@default` makes the field optional in input

---

## 6. Actions

Actions describe **code intent**, not APIs specifically.  
APIs are just one execution surface.

---

### 6.1 Action Syntax

```intent
action create_user:
    input:
        email: string
        password: string @map(hashed_password, hash)

    process:
        derive role = "user"

    output: User(id, email)
```

---

### 6.2 Action Sections (v0.1)

An action may contain the following sections **in order**:

1. `input:` — input contract
2. `process:` — deterministic data derivation
3. `output:` — output projection (required for exposed actions)

---

### 6.3 Action Rules

- No loops
- No recursion
- No conditionals with branching blocks
- No function calls
- No direct DB queries
- No runtime reflection
- Inputs are immutable
- All derived data must be explicit

---

## 7. Action Decorators

### 7.1 API Decorator

```intent
@api METHOD PATH
```

Example:

```intent
@api POST /signup
```

Rules:

- METHOD must be uppercase
- PATH must start with `/`
- One API surface per action (v0.1)

---

### 7.2 Auth Decorator

```intent
@auth(EntityName)
```

Example:

```intent
@auth(User)
```

Meaning:

- Action requires authenticated context
- Auth subject is bound to the specified entity
- Compiler injects:
  - Auth guard
  - Typed `auth_entity` context (e.g. `User`)

---

### 7.3 Output Section

The `output:` section defines the response projection for an action.

```intent
output: Entity(field1, field2)
```

Rules:

- Required for `@api` actions
- Projection is mandatory (specify which fields to return)
- Returning a full entity without projection is forbidden
- Must be the last section in an action

---

## 8. Input Field Decorators

### 8.1 Mapping

```intent
@map(target_field, transform)
```

Examples:

```intent
password: string @map(hashed_password, hash)
email: string @map(email, none)
```

Rules:

- `target_field` must exist on the persisted entity
- `transform` must be a known compiler transform
- Mapping is explicit and deterministic

---

### 8.2 Built-in Transforms (v0.1)

| Transform | Meaning |
|---------|--------|
| `none`  | Direct assignment |
| `hash`  | Secure one-way hash |

---

## 9. Process Section

### 9.1 Purpose

`process:` defines **pure, deterministic derivations**.

No side effects.  
No persistence.  
No external calls.

---

### 9.2 Process Syntax

```intent
process:
    derive field = literal
```

Example:

```intent
process:
    derive status = "active"
```

Rules:

- `derive` creates computed values
- Cannot override input fields
- Cannot access undeclared fields

---

## 10. Complete Example: Auth-Protected API

This example demonstrates all v0.1 features including new types and decorators.

```intent
# User entity with validation and defaults
entity User:
    id: uuid @primary
    email: email @unique @validate(pattern: ".*@.*\\..*")
    username: string @validate(min: 3, max: 20)
    hashed_password: string
    role: string @default("user")
    bio: string @optional
    created_at: datetime @auto

# Secret entity with relationship
entity Secret:
    id: uuid @primary
    title: string @validate(min: 1, max: 100)
    content: string
    owner: ref<User>
    tags: list<string> @optional
    is_encrypted: boolean @default(true)
    created_at: datetime @auto

# Public signup endpoint
@api POST /signup
action signup:
    input:
        email: email
        username: string @validate(min: 3, max: 20)
        password: string @map(hashed_password, hash)
    output: User(id, email, username)

# Protected: Get user's secrets
@auth(User)
@api GET /secrets
action get_secrets:
    output: Secret(id, title, tags, created_at)

# Protected: Create a new secret
@auth(User)
@api POST /secrets
action create_secret:
    input:
        title: string @validate(min: 1, max: 100)
        content: string
        tags: list<string> @optional

    process:
        derive owner = auth.User.id

    output: Secret(id, title, created_at)

# Protected: Get user profile
@auth(User)
@api GET /profile
action get_profile:
    output: User(id, email, username, bio, created_at)
```

---

## 11. Compilation Guarantees

For every valid Intent file, the compiler guarantees:

- Deterministic output
- No implicit data exposure
- No hidden side effects
- Compile-time validation only
- Stable generated code

---

## 12. Explicit Non-Goals (v0.1)

Not supported by design:

- Loops
- Condition blocks
- Async logic
- Events
- Jobs
- Inline scripting
- Dynamic queries
- Partial compilation

---

## 13. Core Principle

> **If the compiler must guess, the intent is invalid.**

---

## 14. Version Roadmap (Preview)

- **v0.2** → validation rules, ownership decorators
- **v0.3** → rules & surfaces
- **v1.0** → stable intent protocol

---

## 15. LLM Quick Reference (Cheat Sheet)

This section provides a condensed reference for LLMs generating Intent code.

### 15.1 Valid Code Template

```intent
# 1. Define entities first
entity EntityName:
    id: uuid @primary
    field1: type @decorator
    field2: type @default(value)
    field3: type @validate(min: 1, max: 100)
    ref_field: ref<OtherEntity>
    list_field: list<string>
    created_at: datetime @auto

# 2. Define actions with decorators BEFORE the action
@auth(EntityName)              # Optional: requires auth
@api METHOD /path              # Required: exposes as API
action action_name:
    input:                     # Optional: input fields
        field: type @map(target, transform)

    process:                   # Optional: derived values
        derive field = value

    output: Entity(f1, f2)    # Required for @api: output projection
```

### 15.2 Quick Rules

| What | Rule |
|------|------|
| **Indentation** | 4 spaces, consistent throughout |
| **Decorators** | Must be on line immediately before target |
| **Primitive Types** | `string`, `number`, `boolean`, `uuid`, `datetime`, `email` |
| **Composite Types** | `ref<Entity>`, `list<T>` |
| **Transforms** | `none` (direct), `hash` (one-way) |
| **Methods** | `GET`, `POST`, `PUT`, `DELETE` (uppercase) |
| **Paths** | Must start with `/` |
| **Output** | Always use projection `output: Entity(field1, field2)` |

### 15.3 Field Decorators Summary

| Decorator | Purpose | Example |
|-----------|---------|---------|
| `@primary` | Primary key | `id: uuid @primary` |
| `@unique` | Unique constraint | `email: email @unique` |
| `@optional` | Nullable | `bio: string @optional` |
| `@auto` | Auto-generated | `created_at: datetime @auto` |
| `@default(v)` | Default value | `status: string @default("active")` |
| `@validate(...)` | Constraints | `age: number @validate(min: 0, max: 150)` |

### 15.4 Common Patterns

**Entity with all features:**
```intent
entity User:
    id: uuid @primary
    username: string @validate(min: 3, max: 20)
    email: email @unique
    hashed_password: string
    role: string @default("user")
    bio: string @optional
    posts: list<ref<Post>>
    created_at: datetime @auto
```

**Public endpoint (no auth):**
```intent
@api GET /health
action health_check:
    output: Status(ok)
```

**Protected endpoint:**
```intent
@auth(User)
@api GET /profile
action get_profile:
    output: User(id, email, username)
```

**Create with transform and defaults:**
```intent
@api POST /signup
action signup:
    input:
        email: email @validate(pattern: ".*@.*\\..*")
        username: string @validate(min: 3, max: 20)
        password: string @map(hashed_password, hash)
    output: User(id, email, username)
```

**Derived fields with auth context:**
```intent
@auth(User)
@api POST /posts
action create_post:
    input:
        title: string @validate(min: 1, max: 200)
        content: string
        tags: list<string> @optional
    process:
        derive author_id = auth.User.id
    output: Post(id, title, author_id)
```

**Entity with relationships:**
```intent
entity Post:
    id: uuid @primary
    title: string
    content: string
    author: ref<User>
    tags: list<string>
    view_count: number @default(0)
    published: boolean @default(false)
    created_at: datetime @auto
```

---
